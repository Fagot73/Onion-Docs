---
title: PWM
layout: guide.hbs
columns: two
devices: [ Omega2 ]
order: 2
---

## Generating PWM signals {#generating-pwm-signals}

The Omega2 and Omega2S provide a number of ways to generate PWM signals.

The Omega module has a number of hardware PWM channels. The timing for these hardware based PWM channels will be highly accurate,
however these hardware PWM channels are only available on specific pins. It is also possible to generate a PWM signal via
a software application. Software PWM can use any GPIO pin but its accuracy is likely to be lower than the hardware PWM and
signal timings can vary based upon system load.

[External hardware](#expansion-external-pwm) such as the PWM Expansion Dock or other hardware based PWM ICs can be used to generate PWM signals.

### Hardware Generated PWM Signals

The Omega's SoC has a number of PWM modules. The Omega2 exposes two (2) PWM hardware modules on its pin headers while the Omega2S exposes all four (4).

> The hardware PWM modules have a frequency range of 39Hz to 40MHz. For lower frequencies it is recommended to consider an external hardware PWM generator or the use of a software generated PWM signal from a GPIO pin.

#### Enabling PWM Pins
The Omega's pins are multiplexed allowing the exposed pins to be used for a number of different functions.

| PWM Channel | GPIO   | Pin | Notes          |
|-------------|--------|-----|----------------|
| 0           | GPIO18 |     |                |
| 1           | GPIO19 |     |                |
| 2           | GPIO20 | 51  | `Omega2S only` |
| 3           | GPIO21 | 52  | `Omega2S only` |

The pin multiplexing configuration can be easily changed from the command line using `omega2-ctrl`.

For GPIO18:
```
omega2-ctrl gpiomux set pwm0 pwm
```

For GPIO19:
```
omega2-ctrl gpiomux set pwm1 pwm
```

For GPIO20:
```
omega2-ctrl gpiomux set uart2 pwm23
```

For GPIO21:
```
omega2-ctrl gpiomux set uart2 pwm23
```

> This multiplexing configuration will need to be repeated after each reboot of the Omega.

#### Enabling PWM signals

Once the appropriate pins have been configured for PWM usage we can configure the PWM hardware module to generate the pwm signal using the following command:
```
onion pwm <CHANNEL> <DUTY CYCLE> <FREQUENCY>
```

Where:

* CHANNEL is 0 (GPIO18), 1 (GPIO19), 2 (GPIO20), or 3 (GPIO21)
  * Remember, Channels 2 & 3 are exposed on the Omega2S only
* DUTY_CYCLE is the percentage of time the signal is `ON`, expressed 0-100
* FREQUENCY is the signal frequency, expressed in Hz

#### Stopping the PWM signal

It is possible to disable the PWM signal:
```
onion pwm <CHANNEL> disable
```

#### Examples

For examples on using the `onion` command to generate PWM signals, see [this blog post](https://onion.io/2bt-hardware-pwm-omega2/).

### Software Generated PWM Signals

The `fast-gpio` utility can be used to generate a software-based PWM signal using a GPIO pin. See the [Using the GPIOs](#fast-gpio) article for full details on the `fast-gpio` utility.

#### Generating a Software-Based PWM Signal

```{r child = './using-gpios-fast-gpio-pwm.md'}
```

### Expansion / external IC generated {#expansion-external-pwm}
The expansion module provides 16 pwm channels generated by a dedicated hardware PWM IC that interfaces via i2c.

> See [Using PWM Expansion](#using-pwm-expansion) for details on the PWM expansion module.

### Programmatic Hardware PWM

The Omega's PWM modules are exposed on Linux via sysfs. The [sysfs PWM interface](https://www.kernel.org/doc/Documentation/pwm.txt)
provides a standardized way to expose PWM hardware for programmatic control from userspace applications.

You can find the PWM chip directories at:

```
/sys/class/pwm
```

```
root@Omega-C0FB:/# ls /sys/class/pwm
pwmchip0
```

> The PWM polarity setting is not currently supported by the Linux kernel mediatek pwm driver. It is possible to support signal inversion by setting the PWM duty cycle to its inverse. For example if the desired duty cycle was 20% but the signal was desired to be inverted, setting the duty cycle to 80%, 100% - 20% = 80%, will achieve the same result.

#### Golang example

Visit [chmorgan/go-pwm-example](https://github.com/chmorgan/go-pwm-example) for an example of controlling the hardware PWM modules from your own application. Through the use of golang, and its support of various architectures, it is possible to build and load this example onto your Omega2 module in a matter of minutes.
